{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>{{ tipo }} - Tucanasta üõí</title>
  <link rel="stylesheet" href="{% static 'css/categoria.css' %}">
</head>

<body>
  <!-- üß≠ NAVBAR -->
  <header class="navbar">
    <a href="{% url 'comparador' %}" class="logo-btn">
      <img src="{% static 'img/logotucan.png' %}" alt="Tucanasta" class="logo-img">
      <span class="brand-name">Tucanasta</span>
    </a>

    <form method="get" action="" class="search-bar">
      <input type="text" name="q" placeholder="Buscar en {{ tipo }}..." value="{{ request.GET.q }}">
      <button type="submit">üîç</button>
    </form>
  </header>

  <main class="main-container">
    <!-- üìã SIDEBAR FILTROS -->
    <aside class="sidebar">
      <form id="filters-form" method="get">
        <h3>Filtros</h3>

        <!-- üîΩ ORDENAR -->
        <div class="filter-section">
          <h4>Ordenar por</h4>
          <select name="ordenar" onchange="document.getElementById('filters-form').submit()">
            <option value="">Relevancia</option>
            <option value="precio_asc" {% if ordenar == 'precio_asc' %}selected{% endif %}>Precio: Menor a mayor</option>
            <option value="precio_desc" {% if ordenar == 'precio_desc' %}selected{% endif %}>Precio: Mayor a menor</option>
            <option value="nombre_asc" {% if ordenar == 'nombre_asc' %}selected{% endif %}>Nombre: A-Z</option>
          </select>
        </div>

        <!-- üè∑Ô∏è MARCAS -->
        <div class="filter-section">
          <h4>Marcas</h4>
          <ul>
            {% for marca in marcas %}
              <li>
                <label>
                  <input 
                    type="checkbox" 
                    name="marca" 
                    value="{{ marca }}" 
                    {% if marca in marca_filtro %}checked{% endif %}
                    onchange="document.getElementById('filters-form').submit()"
                  >
                  {{ marca }}
                </label>
              </li>
            {% empty %}
              <li>No hay marcas registradas.</li>
            {% endfor %}
          </ul>
        </div>

        <!-- üè¨ TIENDAS -->
        <div class="filter-section">
          <h4>Tiendas</h4>
          <ul>
            {% for tienda in tiendas %}
              <li>
                <label>
                  <input 
                    type="checkbox" 
                    name="tienda" 
                    value="{{ tienda }}" 
                    {% if tienda in tienda_filtro %}checked{% endif %}
                    onchange="document.getElementById('filters-form').submit()"
                  >
                  {{ tienda }}
                </label>
              </li>
            {% empty %}
              <li>No hay tiendas disponibles.</li>
            {% endfor %}
          </ul>
        </div>

        <!-- üîç Mantener b√∫squeda -->
        {% if request.GET.q %}
          <input type="hidden" name="q" value="{{ request.GET.q }}">
        {% endif %}

        <!-- üßπ BOT√ìN LIMPIAR FILTROS -->
        <div class="filter-section">
          <button type="button" class="clear-btn" onclick="window.location.href=window.location.pathname">
            Limpiar filtros ‚úñ
          </button>
        </div>
      </form>
    </aside>

    <!-- üõçÔ∏è PRODUCTOS -->
    <section class="products-section">
      <h2>{{ tipo|capfirst }} disponibles</h2>
      <p>{{ productos|length }} resultados encontrados</p>

      <div class="products-grid">
        {% for p in productos %}
          <div class="product-card">
            <img src="{{ p.imagen_url|default:'/static/img/placeholder.png' }}" alt="{{ p.nombre }}">
            <div class="product-info">
              <h3>{{ p.nombre }}</h3>
              <p class="brand">{{ p.marca }}</p>
              <p class="price">${{ p.precio|floatformat:0 }}</p>
              <p class="store">{{ p.supermercado.nombre }}</p>
              <a href="{{ p.producto_url }}" target="_blank" class="buy-btn">Ver producto</a>
            </div>
          </div>
        {% empty %}
          <p>No hay productos disponibles en esta categor√≠a.</p>
        {% endfor %}
      </div>
    </section>
  </main>

  <footer class="footer">
    <p>¬© 2025 Tucanasta. Todos los derechos reservados.</p>
  </footer>
</body>
</html>
